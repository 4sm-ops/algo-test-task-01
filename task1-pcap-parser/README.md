# Task 1: B3 PCAP Parser

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü–∞—Ä—Å–µ—Ä PCAP-—Ñ–∞–π–ª–æ–≤ –±–∏—Ä–∂–∏ B3 (Brasil, Bolsa, Balc√£o) –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö WDO (Mini Dollar) —Ñ—å—é—á–µ—Ä—Å–æ–≤.

## –¶–µ–ª–∏

1. ‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ PCAP ‚Üí —Ç–∞–±–ª–∏—Ü—ã**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ snapshot (—Å–Ω–∏–º–∫–∏ –∫–Ω–∏–≥–∏ –∑–∞—è–≤–æ–∫)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ updates (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV

2. ‚úÖ **–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π —Å–ø—Ä–µ–¥ WDO**
   - –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö WDOZ24 (–¥–µ–∫–∞–±—Ä—å 2024) –∏ WDOF25 (—è–Ω–≤–∞—Ä—å 2025)
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω–æ–≤–æ–≥–æ —Ä—è–¥–∞
   - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞

## –°—Ç–∞—Ç—É—Å

üü¢ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ**

## –î–∞–Ω–Ω—ã–µ

PCAP-—Ñ–∞–π–ª—ã –æ—Ç 18.11.2024 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ `20241118/`:

| –ö–∞–Ω–∞–ª | –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|-------|------|--------|------------|
| 78 | Incremental_feedA.pcap | 656MB | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| 78 | Incremental_feedB.pcap | 656MB | –†–µ–∑–µ—Ä–≤–Ω—ã–π –∫–∞–Ω–∞–ª (dual-feed) |
| 78 | Instrument.pcap | 1.1MB | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ |
| 78 | Snapshot.pcap | 0.9MB | –°–Ω–∏–º–∫–∏ –∫–Ω–∏–≥–∏ –∑–∞—è–≤–æ–∫ |
| 88 | Incremental_*.pcap.zip | 2.9GB | –ê–∫—Ü–∏–∏ (ABEV –∏ –¥—Ä.) |
| 88 | Instrument.pcap | 14MB | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–∫—Ü–∏–π |
| 88 | Snapshot.pcap | 22MB | –°–Ω–∏–º–∫–∏ –∞–∫—Ü–∏–π |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–∞–Ω–∞–ª 78 —Å–æ–¥–µ—Ä–∂–∏—Ç WDO —Ñ—å—é—á–µ—Ä—Å—ã, –∫–∞–Ω–∞–ª 88 ‚Äî –∞–∫—Ü–∏–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
task1-pcap-parser/
‚îú‚îÄ‚îÄ 20241118/                    # PCAP –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ parser.py               # –ü–∞—Ä—Å–µ—Ä PCAP ‚Üí —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ visualization.py        # Plotly –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ output/
‚îÇ   ‚îú‚îÄ‚îÄ snapshot.csv            # –°–Ω–∏–º–∫–∏ –∫–Ω–∏–≥–∏ –∑–∞—è–≤–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ updates.csv             # –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ wdo_prices_incr.csv     # –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ —Ü–µ–Ω WDO
‚îÇ   ‚îú‚îÄ‚îÄ wdo_prices.html         # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ WDOZ24
‚îÇ   ‚îî‚îÄ‚îÄ wdo_spread_demo.html    # –î–µ–º–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞
‚îú‚îÄ‚îÄ main.py                     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ extract_wdo_fast.py         # –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω WDO
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ó–∞–ø—É—Å–∫

```bash
cd task1-pcap-parser
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python main.py
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### CSV —Ñ–∞–π–ª—ã

1. **snapshot.csv** ‚Äî 105 –∑–∞–ø–∏—Å–µ–π —Å–Ω–∏–º–∫–æ–≤ –∫–Ω–∏–≥–∏ –∑–∞—è–≤–æ–∫
   - –ö–æ–ª–æ–Ω–∫–∏: `timestamp_ns`, `timestamp_s`, `security_id`, `symbol`, `entry_type`, `price`, `size`

2. **updates.csv** ‚Äî –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

3. **wdo_prices_incr.csv** ‚Äî 8,522 –∑–∞–ø–∏—Å–µ–π —Ü–µ–Ω WDOZ24
   - –î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω: 5000.40 - 6999.10 BRL

### –ì—Ä–∞—Ñ–∏–∫–∏

1. **wdo_prices.html** ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω WDOZ24
   - –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ 34 –º–∏–Ω—É—Ç—ã —Ç–æ—Ä–≥–æ–≤
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏

2. **wdo_spread_demo.html** ‚Äî –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞
   - –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–ø—Ä–µ–¥–∞ –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

| –°–∏–º–≤–æ–ª | SecurityID | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
|--------|------------|------------|
| WDOZ24 | 200001478879 | 8,522 —Ç–∏–∫–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã–π) |
| WDOF25 | 2080363 | 1 —Ç–∏–∫ (–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π) |

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ —Å–ø—Ä–µ–¥–∞ WDOZ24-WDOF25 –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–æ –∏–∑-–∑–∞:
- WDOF25 (—è–Ω–≤–∞—Ä—å 2025) –∏–º–µ–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–º PCAP —Ñ–∞–π–ª–µ
- –¢–∏–ø–∏—á–Ω–æ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤: –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –±–ª–∏–∂–Ω–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ
- –î–∞–Ω–Ω—ã–µ –∑–∞—Ö–≤–∞—á–µ–Ω—ã –≤–Ω–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤ –¥–ª—è –¥–µferred –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–ø—Ä–µ–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–∏–æ–¥ —Ä–æ–ª–ª–æ–≤–µ—Ä–∞ –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö B3

- **–ü—Ä–æ—Ç–æ–∫–æ–ª:** Binary UMDF (Unified Market Data Feed) —Å SBE (Simple Binary Encoding)
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:** UDP multicast
- **–¶–µ–Ω—ã:** –•—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ `price * 100` (2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
[Packet Header 16 bytes]
‚îú‚îÄ‚îÄ MsgType (2 bytes)
‚îú‚îÄ‚îÄ TemplateID (2 bytes)
‚îú‚îÄ‚îÄ Sequence (4 bytes)
‚îî‚îÄ‚îÄ Timestamp (8 bytes, nanoseconds)

[Message Body]
‚îú‚îÄ‚îÄ SecurityID (8 bytes)
‚îú‚îÄ‚îÄ Price (4 bytes)
‚îî‚îÄ‚îÄ Size (4 bytes)
```

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `scapy` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ PCAP
- `pandas` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `numpy` ‚Äî —á–∏—Å–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã
- `plotly` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
